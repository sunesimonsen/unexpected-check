
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
    <link rel="stylesheet" href="../../../static/normalize.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../static/main.css" type="text/css" media="screen" />
    <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../static/bug-icon-black.ico">
    <title>function - to be valid for all</title>
</head>
<body class="sidebar-hidden has-sidebar">
    <header>
        <div class="logo-icon"></div>
        <nav>
            <ul>
                <li class="menu-toggle-item">
                    <button class="menu-toggle" onclick="toggleSidebar()"></button>
                </li>
                
                <li class=""><a href="../../../">unexpected-check</a></li>
                
                
                <li class="active"><a href="../../any/when-fuzzed-by/">Assertions</a></li>
                
                
                
            </ul>
        </nav>
        <div class="search" style="visibility: hidden">
            <input id="search" placeholder="Search..." value="">
            <div id="searchDropDown" class="dropDown">
                <ul id="searchResults"></ul>
            </div>
        </div>
    </header>

<section id="assertions">
    <nav id="assertion-menu" class="sidebar js-remember-scroll-position">
    
        <h3 class=""><a href="../../any/">any</a></h3>
        <ul>
            
            <li class="">
                <a href="../../any/when-fuzzed-by/">when fuzzed by</a>
            </li>
            
        </ul>
    
        <h3 class=""><a href="../">function</a></h3>
        <ul>
            
            <li class="active">
                <a href="./">to be valid for all</a>
            </li>
            
        </ul>
    
</nav>

    <div class="main" tabindex="-1">
        <div class="content">
            <h1>to be valid for all</h1>
            
                <ul class="declarations">
                
                    <li>&lt;function&gt; to be valid for all &lt;chance-generator+&gt;</li>
                
                    <li>&lt;function&gt; to be valid for all &lt;object&gt;</li>
                
                </ul>
            
            <p>An assertion that runs the subject function up to 300 times with different
generated input. If the subject function fails an error is thrown.</p>
<p>Let&#39;s tests that
<a href="https://www.npmjs.com/package/lodash.unescape">lodash.unescape</a> reverses
<a href="https://www.npmjs.com/package/lodash.escape">lodash.escape</a> we do that the
following way:</p>
<div class="code lang-javascript"><div><span style="color: #07a">const</span>&nbsp;escape&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #DD4A68">require</span><span style="color: #999">(</span><span style="color: #690">'lodash.escape'</span><span style="color: #999">);</span></div><div><span style="color: #07a">const</span>&nbsp;unescape&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #DD4A68">require</span><span style="color: #999">(</span><span style="color: #690">'lodash.unescape'</span><span style="color: #999">);</span></div><div><span style="color: #07a">const</span>&nbsp;<span style="color: #999">{</span>&nbsp;string&nbsp;<span style="color: #999">}</span>&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #DD4A68">require</span><span style="color: #999">(</span><span style="color: #690">'chance-generators'</span><span style="color: #999">);</span></div><div>&nbsp;</div><div><span style="color: #DD4A68">expect</span><span style="color: #999">(</span>text&nbsp;<span style="color: #a67f59">=&gt;</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #DD4A68">expect</span><span style="color: #999">(</span><span style="color: #DD4A68">unescape</span><span style="color: #999">(</span><span style="color: #DD4A68">escape</span><span style="color: #999">(</span>text<span style="color: #999">)),</span>&nbsp;<span style="color: #690">'to&nbsp;equal'</span><span style="color: #999">,</span>&nbsp;text<span style="color: #999">);</span></div><div><span style="color: #999">},</span>&nbsp;<span style="color: #690">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #999">,</span>&nbsp;<span style="color: #DD4A68">string</span><span style="color: #999">({</span>&nbsp;max<span style="color: #999">:</span>&nbsp;<span style="color: #905">200</span>&nbsp;<span style="color: #999">}));</span></div></div><p>This will run 300 tests with random strings of length 0-200 and succeed.</p>
<p>You can specify the max number of iterations that the test should run and the
number of errors it should collect before stopping.</p>
<p>The algorithm searches for the smallest error output, so the more errors you
allow it to collect the better the output will be. </p>
<div class="code lang-javascript"><div><span style="color: #DD4A68">expect</span><span style="color: #999">(</span>text&nbsp;<span style="color: #a67f59">=&gt;</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #DD4A68">expect</span><span style="color: #999">(</span><span style="color: #DD4A68">unescape</span><span style="color: #999">(</span><span style="color: #DD4A68">escape</span><span style="color: #999">(</span>text<span style="color: #999">)),</span>&nbsp;<span style="color: #690">'to&nbsp;equal'</span><span style="color: #999">,</span>&nbsp;text<span style="color: #999">);</span></div><div><span style="color: #999">},</span>&nbsp;<span style="color: #690">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #999">,</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;generators<span style="color: #999">:</span>&nbsp;<span style="color: #999">[</span><span style="color: #DD4A68">string</span><span style="color: #999">({</span>&nbsp;max<span style="color: #999">:</span>&nbsp;<span style="color: #905">200</span>&nbsp;<span style="color: #999">})],</span></div><div>&nbsp;&nbsp;maxIterations<span style="color: #999">:</span>&nbsp;<span style="color: #905">1000</span><span style="color: #999">,</span></div><div>&nbsp;&nbsp;maxErrors<span style="color: #999">:</span>&nbsp;<span style="color: #905">30</span></div><div><span style="color: #999">});</span></div></div><p>I found to following code for
<a href="https://en.wikipedia.org/wiki/Run-length_encoding">Run-length encoding</a> on the
<a href="http://rosettacode.org/wiki/Run-length_encoding#JavaScript">internet</a>, let&#39;s see
if that code also fulfill our round trip test:</p>
<div class="code lang-javascript"><div><span style="color: #07a">function</span>&nbsp;<span style="color: #DD4A68">rleEncode</span><span style="color: #999">(</span>input<span style="color: #999">)</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">var</span>&nbsp;encoding&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #999">[];</span></div><div>&nbsp;&nbsp;input<span style="color: #999">.</span><span style="color: #DD4A68">match</span><span style="color: #999">(</span><span style="color: #e90">/(.)\1*/g</span><span style="color: #999">).</span><span style="color: #DD4A68">forEach</span><span style="color: #999">(</span>substr&nbsp;<span style="color: #a67f59">=&gt;</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;encoding<span style="color: #999">.</span><span style="color: #DD4A68">push</span><span style="color: #999">([</span>substr<span style="color: #999">.</span>length<span style="color: #999">,</span>&nbsp;substr<span style="color: #999">[</span><span style="color: #905">0</span><span style="color: #999">]]);</span></div><div>&nbsp;&nbsp;<span style="color: #999">});</span></div><div>&nbsp;&nbsp;<span style="color: #07a">return</span>&nbsp;encoding<span style="color: #999">;</span></div><div><span style="color: #999">}</span></div><div>&nbsp;</div><div><span style="color: #07a">function</span>&nbsp;<span style="color: #DD4A68">rleDecode</span><span style="color: #999">(</span>encoded<span style="color: #999">)</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">var</span>&nbsp;output&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #690">&quot;&quot;</span><span style="color: #999">;</span></div><div>&nbsp;&nbsp;encoded<span style="color: #999">.</span><span style="color: #DD4A68">forEach</span><span style="color: #999">(</span>pair&nbsp;<span style="color: #a67f59">=&gt;</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;<span style="color: #a67f59">+=</span>&nbsp;<span style="color: #07a">new</span>&nbsp;Array<span style="color: #999">(</span><span style="color: #905">1</span><span style="color: #a67f59">+</span>pair<span style="color: #999">[</span><span style="color: #905">0</span><span style="color: #999">]).</span><span style="color: #DD4A68">join</span><span style="color: #999">(</span>pair<span style="color: #999">[</span><span style="color: #905">1</span><span style="color: #999">]);</span></div><div>&nbsp;&nbsp;<span style="color: #999">});</span></div><div>&nbsp;&nbsp;<span style="color: #07a">return</span>&nbsp;output<span style="color: #999">;</span></div><div><span style="color: #999">}</span></div><div>&nbsp;</div><div><span style="color: #DD4A68">expect</span><span style="color: #999">(</span>text&nbsp;<span style="color: #a67f59">=&gt;</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #DD4A68">expect</span><span style="color: #999">(</span><span style="color: #DD4A68">rleDecode</span><span style="color: #999">(</span><span style="color: #DD4A68">rleEncode</span><span style="color: #999">(</span>text<span style="color: #999">)),</span>&nbsp;<span style="color: #690">'to&nbsp;equal'</span><span style="color: #999">,</span>&nbsp;text<span style="color: #999">);</span></div><div><span style="color: #999">},</span>&nbsp;<span style="color: #690">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #999">,</span>&nbsp;<span style="color: #DD4A68">string</span><span style="color: #999">({</span>&nbsp;max<span style="color: #999">:</span>&nbsp;<span style="color: #905">200</span>&nbsp;<span style="color: #999">}));</span></div></div><!-- unexpected-markdown cleanStackTrace: true -->
<div class="output"><div><span style="color: red; font-weight: bold">Found&nbsp;an&nbsp;error&nbsp;after</span>&nbsp;<span style="color: #0086b3">220</span>&nbsp;<span style="color: red; font-weight: bold">iterations</span></div><div><span style="color: #969896">counterexample:</span></div><div>&nbsp;</div><div>&nbsp;&nbsp;<div style="display: inline-block; vertical-align: top"><div>Generated&nbsp;input:&nbsp;<span style="color: #df5000">''</span></div><div>with:&nbsp;<span style="color: #795da3">string</span>({&nbsp;<span style="color: #555">min</span>:&nbsp;<span style="color: #0086b3">0</span>,&nbsp;<span style="color: #555">max</span>:&nbsp;<span style="color: #0086b3">200</span>&nbsp;})</div><div>&nbsp;</div><div><div style="display: inline-block; vertical-align: top"><div><span style="color: red; font-weight: bold">TypeError:&nbsp;Cannot&nbsp;read&nbsp;property&nbsp;'forEach'&nbsp;of&nbsp;null</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;rleEncode&nbsp;(evalmachine.&lt;anonymous&gt;:3:25)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;string.max&nbsp;(evalmachine.&lt;anonymous&gt;:18:20)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;/Users/ssimonsen/Code/unexpected-check/lib/unexpected-check.js:259:34</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected/build/lib/makePromise.js:68:32</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;tryCatcher&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/util.js:26:23)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Promise._resolveFromResolver&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/promise.js:476:31)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;new&nbsp;Promise&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/promise.js:69:37)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Function.makePromise&nbsp;[as&nbsp;promise]&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected/build/lib/makePromise.js:17:10)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;/Users/ssimonsen/Code/unexpected-check/lib/unexpected-check.js:258:18</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;loop&nbsp;(/Users/ssimonsen/Code/unexpected-check/lib/unexpected-check.js:171:20)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;tryCatcher&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/util.js:26:23)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Promise._settlePromiseFromHandler&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/promise.js:503:31)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Promise._settlePromiseAt&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/promise.js:577:18)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Promise._settlePromises&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/promise.js:693:14)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Async._drainQueue&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/async.js:123:16)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Async._drainQueues&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/async.js:133:10)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Async.drainQueues&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected-bluebird/js/main/async.js:15:14)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected/build/lib/workQueue.js:7:7</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Array.forEach&nbsp;(&lt;anonymous&gt;)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Object.drain&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected/build/lib/workQueue.js:6:16)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;oathbreaker&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected/build/lib/oathbreaker.js:44:13)</span></div><div><span style="color: red; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;Function.expectPrototype._executeExpect&nbsp;(/Users/ssimonsen/Code/unexpected-check/node_modules/unexpected/build/lib/createTopLevelExpect.js:1545:10)</span></div></div></div></div></div></div><p>Something is failing for the empty string input. The problem is that the regular
expression in the encoder does not match the empty string. This would probably
also have been found in a unit test, but these edge cases are easily found using
property based testing. Imagine more complex scenarios where code only fails for
the null character, these cases might be harder to come up with while doing
normal unit testing.</p>
<p>You can supply as many generators as you want. My examples are using
<a href="https://github.com/sunesimonsen/change-generators">chance-generators</a> but you
can using any function that produces a random output when called.</p>
<p>Here is a test that uses more than one generator:</p>
<div class="code lang-javascript"><div><span style="color: #07a">const</span>&nbsp;<span style="color: #999">{</span>&nbsp;word&nbsp;<span style="color: #999">}</span>&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #DD4A68">require</span><span style="color: #999">(</span><span style="color: #690">'chance-generators'</span><span style="color: #999">);</span></div><div>&nbsp;</div><div><span style="color: #DD4A68">expect</span><span style="color: #999">((</span>a<span style="color: #999">,</span>&nbsp;b<span style="color: #999">)</span>&nbsp;<span style="color: #a67f59">=&gt;</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">return</span>&nbsp;<span style="color: #999">(</span>a&nbsp;<span style="color: #a67f59">+</span>&nbsp;b<span style="color: #999">).</span>length&nbsp;<span style="color: #a67f59">===</span>&nbsp;a<span style="color: #999">.</span>length&nbsp;<span style="color: #a67f59">+</span>&nbsp;b<span style="color: #999">.</span>length<span style="color: #999">;</span></div><div><span style="color: #999">},</span>&nbsp;<span style="color: #690">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #999">,</span>&nbsp;word<span style="color: #999">,</span>&nbsp;word<span style="color: #999">);</span></div></div><p>Another example could be to generate actions. </p>
<p>Let&#39;s create a simple queue:</p>
<div class="code lang-javascript"><div><span style="color: #07a">function</span>&nbsp;<span style="color: #DD4A68">Queue</span><span style="color: #999">()</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">this</span><span style="color: #999">.</span>buffer&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #999">[];</span></div><div><span style="color: #999">}</span></div><div>Queue<span style="color: #999">.</span>prototype<span style="color: #999">.</span><span style="color: #DD4A68">enqueue</span>&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #07a">function</span>&nbsp;<span style="color: #999">(</span>value<span style="color: #999">)</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">this</span><span style="color: #999">.</span>buffer<span style="color: #999">.</span><span style="color: #DD4A68">push</span><span style="color: #999">(</span>value<span style="color: #999">);</span></div><div><span style="color: #999">};</span></div><div>Queue<span style="color: #999">.</span>prototype<span style="color: #999">.</span><span style="color: #DD4A68">dequeue</span>&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #07a">function</span>&nbsp;<span style="color: #999">()</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">return</span>&nbsp;<span style="color: #07a">this</span><span style="color: #999">.</span>buffer<span style="color: #999">.</span><span style="color: #DD4A68">shift</span><span style="color: #999">(</span><span style="color: #905">1</span><span style="color: #999">);</span></div><div><span style="color: #999">};</span></div><div>Queue<span style="color: #999">.</span>prototype<span style="color: #999">.</span><span style="color: #DD4A68">isEmpty</span>&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #07a">function</span>&nbsp;<span style="color: #999">()</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">return</span>&nbsp;<span style="color: #07a">this</span><span style="color: #999">.</span>buffer<span style="color: #999">.</span>length&nbsp;<span style="color: #a67f59">===</span>&nbsp;<span style="color: #905">0</span><span style="color: #999">;</span></div><div><span style="color: #999">};</span></div><div>Queue<span style="color: #999">.</span>prototype<span style="color: #999">.</span><span style="color: #DD4A68">drainTo</span>&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #07a">function</span>&nbsp;<span style="color: #999">(</span>array<span style="color: #999">)</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">while</span>&nbsp;<span style="color: #999">(</span><span style="color: #a67f59">!</span><span style="color: #07a">this</span><span style="color: #999">.</span><span style="color: #DD4A68">isEmpty</span><span style="color: #999">())</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;array<span style="color: #999">.</span><span style="color: #DD4A68">push</span><span style="color: #999">(</span><span style="color: #07a">this</span><span style="color: #999">.</span><span style="color: #DD4A68">dequeue</span><span style="color: #999">());</span></div><div>&nbsp;&nbsp;<span style="color: #999">}</span></div><div><span style="color: #999">};</span></div></div><p>Now let&#39;s test that items enqueued always comes out in the right order:</p>
<div class="code lang-javascript"><div><span style="color: #07a">const</span>&nbsp;<span style="color: #999">{</span>&nbsp;array<span style="color: #999">,</span>&nbsp;pickone&nbsp;<span style="color: #999">}</span>&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #DD4A68">require</span><span style="color: #999">(</span><span style="color: #690">'chance-generators'</span><span style="color: #999">);</span></div><div>&nbsp;</div><div><span style="color: #07a">var</span>&nbsp;action&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #DD4A68">pickone</span><span style="color: #999">([</span></div><div>&nbsp;&nbsp;<span style="color: #999">{</span>&nbsp;name<span style="color: #999">:</span>&nbsp;<span style="color: #690">'enqueue'</span><span style="color: #999">,</span>&nbsp;value<span style="color: #999">:</span>&nbsp;string&nbsp;<span style="color: #999">},</span>&nbsp;</div><div>&nbsp;&nbsp;<span style="color: #999">{</span>&nbsp;name<span style="color: #999">:</span>&nbsp;<span style="color: #690">'dequeue'</span>&nbsp;<span style="color: #999">}</span></div><div><span style="color: #999">]);</span></div><div>&nbsp;</div><div><span style="color: #07a">var</span>&nbsp;actions&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #DD4A68">array</span><span style="color: #999">(</span>action<span style="color: #999">,</span>&nbsp;<span style="color: #905">200</span><span style="color: #999">);</span></div><div>&nbsp;</div><div><span style="color: #DD4A68">expect</span><span style="color: #999">(</span><span style="color: #07a">function</span>&nbsp;<span style="color: #999">(</span>actions<span style="color: #999">)</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">var</span>&nbsp;queue&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #07a">new</span>&nbsp;Queue<span style="color: #999">();</span></div><div>&nbsp;&nbsp;<span style="color: #07a">var</span>&nbsp;enqueued&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #999">[];</span></div><div>&nbsp;&nbsp;<span style="color: #07a">var</span>&nbsp;dequeued&nbsp;<span style="color: #a67f59">=</span>&nbsp;<span style="color: #999">[];</span></div><div>&nbsp;&nbsp;actions<span style="color: #999">.</span><span style="color: #DD4A68">forEach</span><span style="color: #999">(</span><span style="color: #07a">function</span>&nbsp;<span style="color: #999">(</span>action<span style="color: #999">)</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #07a">if</span>&nbsp;<span style="color: #999">(</span>action<span style="color: #999">.</span>name&nbsp;<span style="color: #a67f59">===</span>&nbsp;<span style="color: #690">'enqueue'</span><span style="color: #999">)</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enqueued<span style="color: #999">.</span><span style="color: #DD4A68">push</span><span style="color: #999">(</span>action<span style="color: #999">.</span>value<span style="color: #999">);</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue<span style="color: #999">.</span><span style="color: #DD4A68">enqueue</span><span style="color: #999">(</span>action<span style="color: #999">.</span>value<span style="color: #999">);</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999">}</span>&nbsp;<span style="color: #07a">else</span>&nbsp;<span style="color: #07a">if</span>&nbsp;<span style="color: #999">(</span><span style="color: #a67f59">!</span>queue<span style="color: #999">.</span><span style="color: #DD4A68">isEmpty</span><span style="color: #999">())</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dequeued<span style="color: #999">.</span><span style="color: #DD4A68">push</span><span style="color: #999">(</span>queue<span style="color: #999">.</span><span style="color: #DD4A68">dequeue</span><span style="color: #999">());</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999">}</span></div><div>&nbsp;&nbsp;<span style="color: #999">});</span></div><div>&nbsp;</div><div>&nbsp;&nbsp;queue<span style="color: #999">.</span><span style="color: #DD4A68">drainTo</span><span style="color: #999">(</span>dequeued<span style="color: #999">);</span></div><div>&nbsp;</div><div>&nbsp;&nbsp;<span style="color: #DD4A68">expect</span><span style="color: #999">(</span>dequeued<span style="color: #999">,</span>&nbsp;<span style="color: #690">'to&nbsp;equal'</span><span style="color: #999">,</span>&nbsp;enqueued<span style="color: #999">);</span></div><div><span style="color: #999">},</span>&nbsp;<span style="color: #690">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #999">,</span>&nbsp;actions<span style="color: #999">);</span></div></div><p>Support for asynchronous testing by returning a promise from the subject
function:</p>
<div class="code lang-javascript"><div>expect<span style="color: #999">.</span><span style="color: #DD4A68">use</span><span style="color: #999">(</span><span style="color: #DD4A68">require</span><span style="color: #999">(</span><span style="color: #690">'unexpected-stream'</span><span style="color: #999">));</span></div><div>&nbsp;</div><div><span style="color: #07a">return</span>&nbsp;<span style="color: #DD4A68">expect</span><span style="color: #999">(</span><span style="color: #07a">function</span>&nbsp;<span style="color: #999">(</span>text<span style="color: #999">)</span>&nbsp;<span style="color: #999">{</span></div><div>&nbsp;&nbsp;<span style="color: #07a">return</span>&nbsp;<span style="color: #DD4A68">expect</span><span style="color: #999">(</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;text<span style="color: #999">,</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #690">'when&nbsp;piped&nbsp;through'</span><span style="color: #999">,</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999">[</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #DD4A68">require</span><span style="color: #999">(</span><span style="color: #690">'zlib'</span><span style="color: #999">).</span><span style="color: #DD4A68">Gzip</span><span style="color: #999">(),</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #DD4A68">require</span><span style="color: #999">(</span><span style="color: #690">'zlib'</span><span style="color: #999">).</span><span style="color: #DD4A68">Gunzip</span><span style="color: #999">()</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #999">],</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #690">'to&nbsp;yield&nbsp;output&nbsp;satisfying'</span><span style="color: #999">,</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #690">'when&nbsp;decoded&nbsp;as'</span><span style="color: #999">,</span>&nbsp;<span style="color: #690">'utf-8'</span><span style="color: #999">,</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #690">'to&nbsp;equal'</span><span style="color: #999">,</span></div><div>&nbsp;&nbsp;&nbsp;&nbsp;text</div><div>&nbsp;&nbsp;<span style="color: #999">);</span></div><div><span style="color: #999">},</span>&nbsp;<span style="color: #690">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #999">,</span>&nbsp;string<span style="color: #999">);</span></div></div>
        </div>
    </div>
</section>
<script type="text/javascript">
    baseUrl = '../../..';
</script>
<script type="text/javascript" src="../../../static/toggleSidebar.js"></script>
<script type="text/javascript" src="../../../static/rememberScrollPosition.js"></script>
<script type="text/javascript" src="../../../static/focusMain.js"></script>
<script type="text/javascript" src="../../../static/search.js"></script>
</body>
</html>

