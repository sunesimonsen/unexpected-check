
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
    <link rel="stylesheet" href="../../../static/normalize.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../static/main.css" type="text/css" media="screen" />
    <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../static/bug-icon-black.ico">
    <title>function - to be valid for all</title>
</head>
<body class="sidebar-hidden has-sidebar">
    <header>
        <div class="logo-icon"></div>
        <nav>
            <ul>
                <li class="menu-toggle-item">
                    <button class="menu-toggle" onclick="toggleSidebar()"></button>
                </li>
                
                <li class=""><a href="../../..">unexpected-check</a></li>
                
                
                <li class="active"><a href="">Assertions</a></li>
                
                
                
            </ul>
        </nav>
        <div class="search" style="visibility: hidden">
            <input id="search" placeholder="Search..." value="">
            <div id="searchDropDown" class="dropDown">
                <ul id="searchResults"></ul>
            </div>
        </div>
    </header>

<section id="assertions">
    <nav id="assertion-menu" class="sidebar js-remember-scroll-position">
    
        <h3 class=""><a href="..">function</a></h3>
        <ul>
            
            <li class="active">
                <a href="">to be valid for all</a>
            </li>
            
        </ul>
    
</nav>

    <div class="main" tabindex="-1">
        <div class="content">
            <h1>to be valid for all</h1>
            
                <ul class="declarations">
                
                    <li>&lt;function&gt; to be valid for all &lt;function+&gt;</li>
                
                </ul>
            
            <p>An assertion that runs the subject function up to 100 times with different
generated input. If the subject function fails an error is thrown.</p>
<p>Let&#39;s tests that
<a href="https://www.npmjs.com/package/lodash.unescape">lodash.unescape</a> reverses
<a href="https://www.npmjs.com/package/lodash.escape">lodash.escape</a> we do that the
following way:</p>
<div class="code lang-javascript">
  <div><span style="color: #a71d5d">var</span>&nbsp;escape&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #000000">require</span><span style="color: #000000">(</span><span style="color: #df5000">'lodash.escape'</span><span style="color: #000000">);</span></div>
  <div><span style="color: #a71d5d">var</span>&nbsp;unescape&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #000000">require</span><span style="color: #000000">(</span><span style="color: #df5000">'lodash.unescape'</span><span style="color: #000000">);</span></div>
  <div><span style="color: #a71d5d">var</span>&nbsp;g&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #000000">require</span><span style="color: #000000">(</span><span style="color: #df5000">'chance-generators'</span><span style="color: #000000">)(</span><span style="color: #0086b3">666</span><span style="color: #000000">);</span></div>
  <div>&nbsp;</div>
  <div><span style="color: #a71d5d">var</span>&nbsp;strings&nbsp;<span style="color: #a71d5d">=</span>&nbsp;g<span style="color: #000000">.</span><span style="color: #000000">string</span><span style="color: #000000">({</span>&nbsp;length<span style="color: #000000">:</span>&nbsp;g<span style="color: #000000">.</span><span style="color: #000000">natural</span><span style="color: #000000">({</span>&nbsp;max<span style="color: #000000">:</span>&nbsp;<span style="color: #0086b3">200</span>&nbsp;<span style="color: #000000">})</span>&nbsp;<span style="color: #000000">});</span></div>
  <div><span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>text<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div>
  <div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #000000">unescape</span><span style="color: #000000">(</span><span style="color: #000000">escape</span><span style="color: #000000">(</span>text<span style="color: #000000">)),</span>&nbsp;<span style="color: #df5000">'to&nbsp;equal'</span><span style="color: #000000">,</span>&nbsp;text<span style="color: #000000">);</span></div>
  <div><span style="color: #000000">},</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #000000">,</span>&nbsp;strings<span style="color: #000000">);</span></div>
</div><p>This will run 100 tests with random strings of length 0-200.</p>
<p>I found to following code for
<a href="https://en.wikipedia.org/wiki/Run-length_encoding">Run-length encoding</a> on the
<a href="http://rosettacode.org/wiki/Run-length_encoding#JavaScript">internet</a> let&#39;s see
if that code also fulfill our round trip test:</p>
<div class="code lang-javascript">
  <div><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">rleEncode</span><span style="color: #000000">(</span>input<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #a71d5d">var</span>&nbsp;encoding&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #000000">[];</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;input<span style="color: #000000">.</span><span style="color: #000000">match</span><span style="color: #000000">(</span><span style="color: #183691">/(.)\1*/g</span><span style="color: #000000">).</span><span style="color: #000000">forEach</span><span style="color: #000000">(</span><span style="color: #a71d5d">function</span><span style="color: #000000">(</span>substr<span style="color: #000000">){</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;encoding<span style="color: #000000">.</span><span style="color: #000000">push</span><span style="color: #000000">([</span>substr<span style="color: #000000">.</span>length<span style="color: #000000">,</span>&nbsp;substr<span style="color: #000000">[</span><span style="color: #0086b3">0</span><span style="color: #000000">]]);</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000">});</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #a71d5d">return</span>&nbsp;encoding<span style="color: #000000">;</span></div>
  <div><span style="color: #000000">}</span></div>
  <div>&nbsp;</div>
  <div><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">rleDecode</span><span style="color: #000000">(</span>encoded<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #a71d5d">var</span>&nbsp;output&nbsp;<span style="color: #a71d5d">=</span>&nbsp;<span style="color: #df5000">&quot;&quot;</span><span style="color: #000000">;</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;encoded<span style="color: #000000">.</span><span style="color: #000000">forEach</span><span style="color: #000000">(</span><span style="color: #a71d5d">function</span><span style="color: #000000">(</span>pair<span style="color: #000000">){</span>&nbsp;output&nbsp;<span style="color: #a71d5d">+=</span>&nbsp;<span style="color: #a71d5d">new</span>&nbsp;Array<span style="color: #000000">(</span><span style="color: #0086b3">1</span><span style="color: #a71d5d">+</span>pair<span style="color: #000000">[</span><span style="color: #0086b3">0</span><span style="color: #000000">]).</span><span style="color: #000000">join</span><span style="color: #000000">(</span>pair<span style="color: #000000">[</span><span style="color: #0086b3">1</span><span style="color: #000000">])</span>&nbsp;<span style="color: #000000">});</span></div>
  <div>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #a71d5d">return</span>&nbsp;output<span style="color: #000000">;</span></div>
  <div><span style="color: #000000">}</span></div>
  <div>&nbsp;</div>
  <div><span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>text<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div>
  <div>&nbsp;&nbsp;<span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #000000">rleDecode</span><span style="color: #000000">(</span><span style="color: #000000">rleEncode</span><span style="color: #000000">(</span>text<span style="color: #000000">)),</span>&nbsp;<span style="color: #df5000">'to&nbsp;equal'</span><span style="color: #000000">,</span>&nbsp;text<span style="color: #000000">);</span></div>
  <div><span style="color: #000000">},</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #000000">,</span>&nbsp;strings<span style="color: #000000">);</span></div>
</div><div class="output">
  <div><span style="color: red; font-weight: bold">Ran&nbsp;</span><span style="color: #0086b3">100</span>&nbsp;<span style="color: red; font-weight: bold">iterations&nbsp;and&nbsp;found&nbsp;</span><span style="color: #0086b3">1</span><span style="color: red; font-weight: bold">&nbsp;errors</span></div>
  <div><span style="color: red; font-weight: bold">counterexample:</span></div>
  <div>&nbsp;</div>
  <div>&nbsp;&nbsp;<div style="display: inline-block; vertical-align: top">
  <div>Generated&nbsp;input:&nbsp;<span style="color: #df5000">''</span></div>
  <div>&nbsp;</div>
  <div><div style="display: inline-block; vertical-align: top">
  <div>Cannot&nbsp;read&nbsp;property&nbsp;'forEach'&nbsp;of&nbsp;null</div>
</div></div>
</div></div>
</div><p>Something is failing for the empty string input. The problem is that the regular
expression in the encoder does not match the empty string. This would probably
also have been found in a unit test case, but these edge cases are easily fund
using property based testing. Imagine more complex scenarios where code only
fails for the null character, these cases might be harder to come up with while
doing normal unit testing.</p>
<p>You can supply as many generators as you want. My examples are using
<a href="https://github.com/sunesimonsen/change-generators">chance-generators</a> but you
can using any function that produces a random output when called.</p>
<p>Here is a test that uses more than one generator:</p>
<div class="code lang-javascript">
  <div><span style="color: #000000">expect</span><span style="color: #000000">(</span><span style="color: #a71d5d">function</span>&nbsp;<span style="color: #000000">(</span>a<span style="color: #000000">,</span>&nbsp;b<span style="color: #000000">)</span>&nbsp;<span style="color: #000000">{</span></div>
  <div>&nbsp;&nbsp;<span style="color: #a71d5d">return</span>&nbsp;<span style="color: #000000">(</span>a&nbsp;<span style="color: #a71d5d">+</span>&nbsp;b<span style="color: #000000">).</span>length&nbsp;<span style="color: #a71d5d">===</span>&nbsp;a<span style="color: #000000">.</span>length&nbsp;<span style="color: #a71d5d">+</span>&nbsp;b<span style="color: #000000">.</span>length<span style="color: #000000">;</span></div>
  <div><span style="color: #000000">},</span>&nbsp;<span style="color: #df5000">'to&nbsp;be&nbsp;valid&nbsp;for&nbsp;all'</span><span style="color: #000000">,</span>&nbsp;g<span style="color: #000000">.</span>word<span style="color: #000000">,</span>&nbsp;g<span style="color: #000000">.</span>word<span style="color: #000000">);</span></div>
</div>
        </div>
    </div>
</section>
<script type="text/javascript">
    baseUrl = '../../..';
</script>
<script type="text/javascript" src="../../../static/toggleSidebar.js"></script>
<script type="text/javascript" src="../../../static/rememberScrollPosition.js"></script>
<script type="text/javascript" src="../../../static/focusMain.js"></script>
<script type="text/javascript" src="../../../static/search.js"></script>
</body>
</html>

